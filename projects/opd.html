<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OPD Waiting Time Analysis | Masani Santhosh Kumar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../css/style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

</head>

<body>

<section class="projects">
<div class="container">

<h2>OPD Waiting Time Analysis using Probability & Random Processes</h2>

<!-- OVERVIEW -->
<div class="project-card" style="margin-bottom:40px;">
<h3>Project Overview</h3>
<p>
This simulator recreates a real OPD environment mathematically using stochastic modelling.
Instead of static inputs, it generates random patient arrivals and service times,
simulates complete queue behaviour minute-by-minute,
and computes key performance indicators such as waiting time and doctor utilization.
</p>
<p>
The goal is to convert unpredictable hospital crowding into measurable,
data-driven staffing decisions.
</p>
</div>

<!-- WHAT MAKES UNIQUE -->
<div class="project-card" style="margin-bottom:40px;">
<h3>What Makes This Tool Unique?</h3>
<p>
• Generates random patient arrivals<br>
• Simulates consultations using probability distributions<br>
• Models real queue behaviour dynamically<br>
• Calculates waiting time & utilization<br>
• Automatically detects overstaffing or understaffing<br>
• Provides graphical decision support
</p>
</div>

<!-- STAR FORMAT -->
<div class="project-card" style="margin-bottom:40px;">
<h3>STAR Explanation</h3>

<p><strong>S — Situation:</strong><br>
OPD crowding is unpredictable. Sudden spikes in patient load drastically increase waiting time and reduce operational efficiency.
</p>

<br>

<p><strong>T — Task:</strong><br>
To mathematically analyze OPD queue flow and determine optimal doctor staffing without overstaffing or increasing idle time.
</p>

<br>

<p><strong>A — Action:</strong><br>
Developed a Python-based stochastic simulation tool that:
<br>• Takes OPD parameters as input  
<br>• Generates exponential arrival & service patterns  
<br>• Simulates queue progression  
<br>• Calculates waiting time & utilization  
<br>• Recommends optimal doctor count  
</p>

<br>

<p><strong>R — Result:</strong><br>
The simulation proved that even a single doctor difference can significantly impact waiting time,
highlighting the importance of data-driven hospital staffing.
</p>

</div>

<!-- HOW IT WORKS -->
<div class="project-card" style="margin-bottom:40px;">
<h3>How the System Works</h3>

<p>
1️⃣ User inputs session duration, number of doctors, patients, and consultation time.
</p>
<p>
2️⃣ Random arrival times are generated using exponential distribution.
</p>
<p>
3️⃣ Service times are simulated using stochastic modelling.
</p>
<p>
4️⃣ Queue progression is calculated minute-by-minute.
</p>
<p>
5️⃣ System computes:
</p>

<ul>
<li>Average waiting time</li>
<li>Maximum waiting time</li>
<li>Doctor utilization percentage</li>
<li>Staffing recommendation</li>
</ul>

</div>

<!-- SOFTWARE -->
<div class="project-card" style="margin-bottom:40px;">
<h3>Software Used</h3>

<p>
• Google Colab (Cloud-based execution)<br>
• Python<br>
• Random & Math modules<br>
• Matplotlib for visualization
</p>

</div>

<!-- CODE -->
<div class="project-card" style="margin-bottom:40px;">
<h3>Core Simulation Code (Python)</h3>

<pre>
import random
import math
import matplotlib.pyplot as plt
from matplotlib.patches import FancyBboxPatch

# ---------- Simulation Function ----------
def simulate_opd(total_patients, session_hours, num_doctors, avg_service_time_min, seed=42):
    """M/M/c style OPD simulation with random arrivals and service times."""
    arrival_rate = total_patients / (session_hours * 60.0)   # patients per minute
    service_rate = 1.0 / avg_service_time_min                # patients per minute per doctor

    random.seed(seed)
    arrival_times = [0.0]
    for _ in range(1, total_patients):
        inter = random.expovariate(arrival_rate)
        arrival_times.append(arrival_times[-1] + inter)

    service_times = [random.expovariate(service_rate) for _ in range(total_patients)]

    doctor_next_free = [0.0] * num_doctors
    doctor_busy = [0.0] * num_doctors

    start_times, end_times, wait_times, assigned_doctor = [], [], [], []

    for i in range(total_patients):
        arr = arrival_times[i]
        d = min(range(num_doctors), key=lambda x: doctor_next_free[x])

        start = max(arr, doctor_next_free[d])
        end = start + service_times[i]
        wait = start - arr

        doctor_next_free[d] = end
        doctor_busy[d] += service_times[i]

        start_times.append(start)
        end_times.append(end)
        wait_times.append(wait)
        assigned_doctor.append(d)

    avg_wait = sum(wait_times) / total_patients
    max_wait = max(wait_times)
    total_time = max(end_times) - min(arrival_times)
    utilisation = sum(doctor_busy) / (total_time * num_doctors)

    return {
        "arrival": arrival_times,
        "start": start_times,
        "end": end_times,
        "wait": wait_times,
        "doctor": assigned_doctor,
        "avg_wait": avg_wait,
        "max_wait": max_wait,
        "util": utilisation,
    }

# ---------- Input Section ----------
print("Santhosh OPD Simulator\n")

patients = int(input("Total patients in this OPD session        : "))
hours    = float(input("Session duration (hours)                  : "))
docs     = int(input("Number of doctors (current)               : "))
t        = float(input("Average consultation time (minutes)       : "))

# Internal rate calculations (not shown as formula in output)
arrival_rate_per_hour = patients / hours
service_rate_per_doc_per_hour = 60.0 / t
capacity_current = service_rate_per_doc_per_hour * docs

# Recommended number of doctors (internal only)
recommended_docs = max(1, math.ceil(arrival_rate_per_hour / service_rate_per_doc_per_hour))

# ---------- Simulate Current Setup ----------
current = simulate_opd(patients, hours, docs, t)

print("\n================= CURRENT OPD SUMMARY =================")
print(f"Session duration              : {hours:.2f} hours")
print(f"Total patients                : {patients}")
print(f"Number of doctors (current)   : {docs}")
print(f"Average consultation time     : {t:.2f} min/patient")
print(f"Average arriving patients     : {arrival_rate_per_hour:.2f} per hour")
print(f"Patients handled per hour     : {capacity_current:.2f} (approx.)")
print("======================================================\n")

print("----------- CURRENT PERFORMANCE ----------------------")
print(f"Average waiting time          : {current['avg_wait']:.2f} minutes")
print(f"Maximum waiting time          : {current['max_wait']:.2f} minutes")
print(f"Overall doctor utilisation    : {current['util']*100:.2f}%")
print("------------------------------------------------------\n")

print("First 10 patients (illustration):")
header = f"{'Pat':>3} | {'Arr(min)':>8} | {'Start(min)':>10} | {'End(min)':>8} | {'Wait(min)':>9} | {'Doc':>3}"
print(header)
print("-" * len(header))
for i in range(min(10, patients)):
    print(f"{i:>3} | "
          f"{current['arrival'][i]:>8.2f} | "
          f"{current['start'][i]:>10.2f} | "
          f"{current['end'][i]:>8.2f} | "
          f"{current['wait'][i]:>9.2f} | "
          f"{current['doctor'][i]:>3}")

# ---------- Graph: Current Setup ----------
plt.figure(figsize=(9, 4))
plt.bar(range(patients), current["wait"])
plt.axhline(current["avg_wait"], linestyle="--")
plt.title("Waiting Time per Patient - Current Setup")
plt.xlabel("Patient index")
plt.ylabel("Waiting time (minutes)")
plt.grid(True, axis="y")
plt.tight_layout()
plt.show()

# ---------- Case 1: No Recommendation Needed ----------
if recommended_docs == docs:
    fig, ax = plt.subplots(figsize=(8, 3))
    ax.axis("off")

    # simple neat text block
    ax.text(0.08, 0.60, "Santhosh OPD Simulator", fontsize=18, fontweight="bold")
    ax.text(
        0.08, 0.40,
        "The current number of doctors is suitable\nfor this OPD session.",
        fontsize=11,
    )

    # box for thank you
    box = FancyBboxPatch(
        (0.06, 0.10), 0.88, 0.20,
        boxstyle="round,pad=0.02",
        edgecolor="black",
        facecolor="whitesmoke",
        linewidth=1.5,
    )
    ax.add_patch(box)
    ax.text(
        0.50,
        0.20,
        "Thanks for using Santhosh OPD Simulator\nGet well soon",
        fontsize=13,
        fontweight="bold",
        ha="center",
        va="center",
    )

    plt.tight_layout()
    plt.show()

# ---------- Case 2: Recommendation (overload or underload) ----------
else:
    improved = simulate_opd(patients, hours, recommended_docs, t)
    capacity_rec = service_rate_per_doc_per_hour * recommended_docs

    print("================= RECOMMENDATION ====================")
    if recommended_docs > docs:
        print(f"To handle this load more comfortably, using {recommended_docs} doctors")
        print(f"instead of {docs} can reduce crowding and share the workload better.\n")
    else:
        print(f"For this load, {recommended_docs} doctors are sufficient instead of {docs}.")
        print("This reduces idle time while keeping waiting times under control.\n")

    print("Recommended configuration:")
    print(f"- Doctors                    : {recommended_docs}")
    print(f"- Patients handled per hour  : {capacity_rec:.2f} (approx.)")
    print(f"- Average waiting time       : {improved['avg_wait']:.2f} minutes")
    print(f"- Maximum waiting time       : {improved['max_wait']:.2f} minutes")
    print(f"- Doctor utilisation         : {improved['util']*100:.2f}%")
    print("======================================================\n")

    print("Effect of applying this recommendation:")
    print(f"- Average waiting time changes from {current['avg_wait']:.2f} min "
          f"to {improved['avg_wait']:.2f} min.")
    print(f"- Doctor utilisation changes from {current['util']*100:.1f}% "
          f"to {improved['util']*100:.1f}%.")
    print()

    # Graph: Recommended setup
    plt.figure(figsize=(9, 4))
    plt.bar(range(patients), improved["wait"])
    plt.axhline(improved["avg_wait"], linestyle="--")
    plt.title(f"Waiting Time per Patient - Recommendation ({recommended_docs} Doctors)")
    plt.xlabel("Patient index")
    plt.ylabel("Waiting time (minutes)")
    plt.grid(True, axis="y")
    plt.tight_layout()
    plt.show()

    # Comparison table image (no overlap, only table + title)
    fig, ax = plt.subplots(figsize=(8, 4))
    ax.axis("off")

    table_data = [
        ["Parameter",              "Current",                         "Recommended"],
        ["Number of doctors",      f"{docs}",                         f"{recommended_docs}"],
        ["Patients/hour (approx.)",f"{capacity_current:.1f}",         f"{capacity_rec:.1f}"],
        ["Avg waiting time (min)", f"{current['avg_wait']:.1f}",      f"{improved['avg_wait']:.1f}"],
        ["Max waiting time (min)", f"{current['max_wait']:.1f}",      f"{improved['max_wait']:.1f}"],
        ["Doctor utilisation (%)", f"{current['util']*100:.1f}",      f"{improved['util']*100:.1f}"],
    ]

    table = ax.table(
        cellText=table_data[1:],
        colLabels=table_data[0],
        loc="center"
    )
    table.auto_set_font_size(False)
    table.set_fontsize(10)
    table.scale(1, 1.3)

    ax.set_title("OPD CONFIGURATION COMPARISON", fontweight="bold", pad=20)
    plt.tight_layout()
    plt.show()

    # Separate neat thank-you box
    fig, ax = plt.subplots(figsize=(8, 2.5))
    ax.axis("off")

    box = FancyBboxPatch(
        (0.06, 0.25), 0.88, 0.45,
        boxstyle="round,pad=0.02",
        edgecolor="black",
        facecolor="whitesmoke",
        linewidth=1.5,
    )
    ax.add_patch(box)
    ax.text(
        0.50,
        0.48,
        "Thanks for using Santhosh OPD Simulator\nGet well soon",
        fontsize=13,
        fontweight="bold",
        ha="center",
        va="center",
    )

    plt.tight_layout()
    plt.show()

</pre>

</div>

<!-- RESULTS -->
<div class="project-card" style="margin-bottom:40px;">
<h3>Simulation Results</h3>

<img src="../assets/opd1.png" class="project-image">
<img src="../assets/opd2.png" class="project-image">
<img src="../assets/opd3.png" class="project-image">
<img src="../assets/opd4.png" class="project-image">
<img src="../assets/opd5.png" class="project-image">

</div>

<!-- VIDEO -->
<div class="project-card" style="margin-bottom:40px;">
<h3>Demo Video</h3>

<video controls style="width:100%; max-width:800px; border-radius:12px;">
<source src="../assets/opd-demo.mp4" type="video/mp4">
</video>

</div>

<a href="../index.html" class="btn secondary">Back to Projects</a>

</div>
</section>

</body>
</html>
